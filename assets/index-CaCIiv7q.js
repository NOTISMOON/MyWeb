import{d as j,s as l,y as R,M as B,N as P,c,g as U,a as s,B as I,j as H,F as _,D as S,b as N,t as p,C as F,o as d,A as W}from"./index-M1UoG1Yi.js";import{d as G}from"./index.vue_vue_type_script_setup_true_lang-CEyQ4nHz.js";const J={class:"min-h-screen py-8",id:"video"},K={class:"ml-[5%] mr-[5%] flex gap-3 overflow-x-auto pb-2 mb-6 scrollbar-hide"},O=["onClick"],q={class:"relative w-[90%] mx-auto"},Q={class:"bg-white h-full rounded-xl overflow-hidden shadow-md hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1"},X=["onClick"],Y=["src","onLoad"],Z={class:"absolute bottom-2 right-2 bg-black/70 text-white text-xs px-2 py-0.5 rounded backdrop-blur-sm"},ee={class:"p-3"},te={class:"font-medium text-gray-800 line-clamp-2 mb-2 h-12 text-sm"},oe={class:"flex items-center text-gray-500 text-xs"},se={class:"flex items-center mr-3"},ne={key:0,class:"text-center mt-8"},ae={key:1,class:"text-center mt-8 text-gray-500 text-sm"},ce=j({__name:"index",setup(le){const v=l([]),$=l(["全部","NEST","REACT","ES6","VUE","JavaScript","CSS"]),g=l([]),k=l(),w=l({}),m=l(!1),h=l(!0),M=l(1),z={mounted:async t=>{const e=()=>{const a=Array.from(t.childNodes).filter(u=>u.nodeType===1);if(a.length===0)return;const r=t.offsetWidth,i=Math.max(1,Math.floor(r/a[0].offsetWidth)),x=r-i*a[0].offsetWidth,D=i>1?x/(i-1):0,f=new Array(i).fill(0);a.forEach(u=>{u.style.position="absolute";const E=Math.min(...f),L=f.indexOf(E);u.style.top=E+"px",u.style.left=L*(u.offsetWidth+D)+"px",f[L]+=u.offsetHeight+D}),t.style.height=Math.max(...f)+20+"px"},n=((a,r=0)=>{let i=null;return(...x)=>{i&&clearTimeout(i),i=window.setTimeout(()=>a.apply(this,x),r)}})(e);window.addEventListener("resize",n),t._waterfallRender=n,W(e)},updated:t=>{W(()=>{var e;(e=t._waterfallRender)==null||e.call(t)})},unmounted:t=>{window.removeEventListener("resize",t._waterfallRender)}},T=t=>"https://websarvice-190762-4-1381433578.sh.run.tcloudbase.com"+t,b=l("全部"),y=(t="全部")=>{if(b.value=t,t=="全部")return g.value=v.value;g.value=v.value.filter(e=>e.category==t)},A=t=>{const o=`${window.location.origin}/MyWeb/player/${t.id}`,n=window.open(o,"_blank");if(n){const a=r=>{console.log(3),r.origin===window.location.origin&&r.data.type==="readplay"&&r.source===n&&n.postMessage({type:"videoData",...t},window.location.origin)};window.addEventListener("message",a,{once:!0})}},V=async()=>{var o;if(m.value||!h.value)return;m.value=!0,M.value++;const e=(await B(M.value)).videos.map(n=>(n.cover=T(n.cover),n));(o=v.value)==null||o.push(...e),y(b.value),v.value.length>=k.value&&(h.value=!1),m.value=!1},C=()=>{if(m.value||!h.value)return;const t=document.documentElement.scrollTop||document.body.scrollTop,e=document.documentElement.clientHeight||window.innerHeight;(document.documentElement.scrollHeight||document.body.scrollHeight)-t-e<5&&V()};return R(async()=>{const t=await B();k.value=t.total,v.value=t.videos.map(e=>(e.cover=T(e.cover),e)),y(),document.addEventListener("scroll",C)}),P(()=>{document.removeEventListener("scroll",C)}),(t,e)=>(d(),c(_,null,[U(G),s("div",J,[e[3]||(e[3]=s("div",{class:"ml-[5%] mt-[3.5%] text-2xl font-bold border-b-2 border-blue-500 pb-2 inline-block mb-6"}," 视频分类 ",-1)),s("div",K,[(d(!0),c(_,null,S($.value,(o,n)=>(d(),c("button",{key:n,onClick:a=>y(o),class:N([{"bg-blue-500":o==b.value},"text-white px-4 py-2 rounded-full text-sm whitespace-nowrap shadow-sm hover:bg-blue-600 transition-colors"])},p(o),11,O))),128))]),e[4]||(e[4]=s("p",{class:"ml-[5%] mr-[5%] text-lg font-semibold text-gray-800 mb-6"},"视频区",-1)),I((d(),c("div",q,[(d(!0),c(_,null,S(g.value,o=>(d(),c("div",{key:o.id,class:"group w-[10rem]"},[s("div",Q,[s("div",{class:"w-full relative",onClick:n=>A(o)},[s("img",{src:o.cover,alt:"视频缩略图",class:N(["w-full h-full object-cover transition-transform duration-500 group-hover:scale-105",{"opacity-0":!w.value[o.id],"opacity-100":w.value[o.id]}]),loading:"lazy",onLoad:n=>w.value[o.id]=!0,style:{transition:"opacity 0.3s ease-in-out",background:"#f0f0f0"}},null,42,Y),s("span",Z,p(o.duration),1),e[0]||(e[0]=s("div",{class:"absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"},[s("svg",{class:"w-10 h-10 text-white",fill:"currentColor",viewBox:"0 0 24 24"},[s("path",{d:"M8 5v14l11-7z"})])],-1))],8,X),s("div",ee,[s("h3",te,p(o.title),1),s("div",oe,[s("span",se,[e[1]||(e[1]=s("svg",{class:"w-3.5 h-3.5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)),F(" "+p(Math.floor(Math.random()*1e4)+100),1)]),s("span",null,p(new Date().getDate()-new Date(o.uploadTime).getDate()?`${new Date(new Date().getDate()-new Date(o.uploadTime).getDate()).getDate()}天前`:"今天"),1)])])])]))),128))])),[[z]]),m.value?(d(),c("div",ne,e[2]||(e[2]=[s("div",{class:"inline-block w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"},null,-1),s("p",{class:"text-sm text-gray-500 mt-2"},"加载中...",-1)]))):H("",!0),!h.value&&!m.value?(d(),c("div",ae," 已加载全部内容 ")):H("",!0)])],64))}});export{ce as default};
